---
layout: post
title:  "Guinness Pro12 15/16: A hierarchial model"
date:   2016-05-13
comments: true
tags: [Bayesian]
---

Recently I read this [this](http://springcoil.github.io/Bayesian_Model.html) blog post which looks at applying a hierarchial bayesian model to understand the uncertainty of the attacking and defensive strengths of different teams in the Six Nations. It is actually a replication of [another](http://danielweitzenfeld.github.io/passtheroc/blog/2014/10/28/bayes-premier-league/) blog post which applies the model to the English Premier League. The models that both blogs use are actually based off an [paper](http://www.statistica.it/gianluca/Research/BaioBlangiardo.pdf) outlining two such models and applying them to the Serie A, the premier division of Italian football.

The league portion of the 15/16 Guinness Pro 12 finished up last week. I thought it might be fun to apply the same technique to this data, especially with the semi finals taking place next weekend. Just like the blogs above deviate slightly from the models outlined in the paper, I have made some minor adjustments while also doing everything in R using [JAGS](http://mcmc-jags.sourceforge.net/).

## Pro12 Data

I expected a good bit of wrangling to get the data I needed but it turned out to be pretty straight forward. I went to the [Pro 12](http://www.pro12rugby.com/) website and went to the Fixtures and Results section. All the data I needed was there but I haven't scraped much data from the web in my time. I took a punt and googled something like `R html table` and found the readHTMLTable function which is a part of the [XML](https://cran.r-project.org/web/packages/XML/index.html) package. So I pointed this at the URL in my browser and hoped for the best!

It seemed to return a list containing a NULL and two dataframes. They were both quite similiar but I just picked one and then went about tidying it up. It's all shown below.


{% highlight r %}
# Specific URL for 2015-2016
theurl <- "http://www.pro12rugby.com/matchcentre/fixtures_list.php?includeref=10808&season=2015-2016#z8HvpmemZhdCZzOK.97"
dt.pro12.results <- readHTMLTable(theurl, stringsAsFactors=FALSE)
# It's clear that any row with NAs is the header from a particular round.
dt.pro12.results <- as.data.table(na.omit(dt.pro12.results[[3]]))
# The column names we want are stuck in the first row so drop it after getting the names.
pro12.col.names <- as.character(unlist(dt.pro12.results[1]))
dt.pro12.results <- dt.pro12.results[-1,]
# If the column name is blank we'll be dropping this column
pro12.col.names[pro12.col.names==''] <- 'drop'
colnames(dt.pro12.results) <- pro12.col.names
dt.pro12.results[,drop := NULL]
# colnames to lower case
setnames(dt.pro12.results,tolower(colnames(dt.pro12.results)))
# having a / in a colname is annoying
setnames(dt.pro12.results,'tv/att','attendence')

# Any row with a v in the score column is a game that hasn't been played yet.
# When the final is over there will be none of these, and the last three games
# will need to be dropped to replicate this analysis.
dt.pro12.results <- dt.pro12.results[score!='v',]

# Attendence should be an integer
dt.pro12.results[,attendence := as.integer(gsub(',', '', attendence))]

# add home and away score columns. tstrsplit is very handy here.
dt.pro12.results[, c("h", "a") := tstrsplit(score, " - ", type.convert=TRUE)]

# Add a game id. Seems wrong not to.
dt.pro12.results[,game.id:=.I]
{% endhighlight %}



## 
